calc: main.c opstr.gen.h
	$(CC) -o calc -DDEBUG main.c

opstr.gen.h: main.c
	(echo '// Do not edit this file! Edit main.c and run `make opstr.gen.h` ' &&\
	  echo 'const char * opstr[] = { ' &&\
	  grep -E '^\s*OP_[A-Z]+,$$' main.c|sed -E 's/^\s*(OP_[A-Z]+),$$/  "\1",/' &&\
	  echo '};') > opstr.gen.h

clean:
	rm -f calc opstr.gen.h
